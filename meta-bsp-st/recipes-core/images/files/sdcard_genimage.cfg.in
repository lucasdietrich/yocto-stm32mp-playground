image @IMAGE@-@MACHINE@-sdcard.img {
    hdimage {
        partition-table-type = "gpt"
    }

    # According to STM32MP1 Boot ROM documentation: https://wiki.st.com/stm32mpu/wiki/STM32_MPU_ROM_code_overview
    # > On STM32MP13x lines and STM32MP15x lines, it locates two FSBLs by 
    # > looking for the two first GPT entries of which the name begins with "fsbl".
	partition fsbl1 {
        image = "tf-a/tf-a-@TFA_DEVICETREE@.stm32"

        # SYSRAM size is 256K on STM32MP1
        size = 256K
	}

	partition fsbl2 {
        image = "tf-a/tf-a-@TFA_DEVICETREE@.stm32"
        size = 256K
	}

    partition tee-header {
        image = "optee-os/tee-header_v2.bin"
        size = 4K
    }

    partition tee-pager {
        image = "optee-os/tee-pager_v2.bin"
        size = 256K
    }

    partition tee-pageable {
        image = "optee-os/tee-pageable_v2.bin"
        size = 1M
    }

    partition u-boot {
        image = "u-boot/u-boot.bin"
        size = 1M
    }

    partition u-boot-env {
        size = 128K
    }

    partition bootfs {
        image = "bootfs.vfat"
    }

    partition rootfs {
        image = "@IMAGE_ROOTFS@"
        size = 64M
    }
}

image bootfs.vfat {
    vfat {
        label = "bootfs"
        files = {
            "kernel/zImage",
            "kernel/stm32mp157f-dk2-amy.dtb"
        }
    }
    size = 16M
}